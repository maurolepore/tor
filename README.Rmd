---
output: github_document
editor_options: 
  chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# tor

[![lifecycle](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![Travis build status](https://travis-ci.org/maurolepore/tor.svg?branch=master)](https://travis-ci.org/maurolepore/tor)
[![Coverage status](https://coveralls.io/repos/github/maurolepore/tor/badge.svg)](https://coveralls.io/r/maurolepore/tor?branch=master)
[![CRAN status](https://www.r-pkg.org/badges/version/tor)](https://cran.r-project.org/package=tor)

The goal of __tor__ is to import multiple files of any kind into R. It does nothing you can't do with functions from base R (or [__fs__](https://fs.r-lib.org/) plus [__purrr__](https://purrr.tidyverse.org/) plus some reader package) but it provides a shortcut to save your time and brain power for more important tasks. __tor__ is flexible and small, and works well with tools from the [tidyverse](https://www.tidyverse.org/). 

## Installation

``` r
# install.packages("devtools")
devtools::install_github("maurolepore/tor")
```

## Example

```{r}
library(purrr)
library(fs)
library(tor)
```

All functions list whatever they read, and default to reading from the working directory.

```{r}
dir()

list_csv()
```

But often you will specify a `path`.

```{r}
# Helpes create paths to examples
tor_example()

(path_rds <- tor_example("rds"))
dir(path_rds)

list_rds(path_rds)

(path_tsv <- tor_example("tsv"))
dir(path_tsv)

list_tsv(path_tsv)

path_mixed <- tor_example("mixed")
dir(path_mixed)

list_csv(path_mixed)

list_rdata(path_mixed)
```

`list_any()` is the most flexible function. You supply the function to read with.

```{r}
(path_csv <- tor_example("csv"))
dir(path_csv)

list_any(path_csv, read.csv)
```

It understands lambda functions and formulas (powered by [__rlang__](https://rlang.r-lib.org/)).

```{r}
(path_rdata <- tor_example("rdata"))
dir(path_rdata)

path_rdata %>% 
  list_any(function(x) get(load(x)))

# Same
path_rdata %>% 
  list_any(~get(load(.x)))
```

Pass additional arguments via `...` or inside the lambda function.

```{r}
list_any(path_csv, read.csv, stringsAsFactors = FALSE)

list_any(path_csv, ~read.csv(., stringsAsFactors = FALSE))
```

Use `regexp`, `ignore.case`, and `invert` to pick specific files in a directory (powered by [__fs__](https://fs.r-lib.org/)).

```{r}
path_mixed <- tor_example("mixed")
dir(path_mixed)

path_mixed %>% 
  list_any(~get(load(.)), "[.]Rdata$", ignore.case = TRUE)

path_mixed %>% 
  list_any(~get(load(.)), regexp = "[.]csv$", invert = TRUE)
```

### Writing data

__tor__ does not write data but includes a helper to create the paths to output files.

```{r}
dir(pattern = "[.]csv$")

dfms <- list_csv()

format_path(names(dfms), "csv")

format_path(names(dfms), "csv", base = "home", prefix = "this-")
```

Combine it with [__purrr__](https://purrr.tidyverse.org/).

```{r}
imap_chr(dfms, ~ format_path(.y, "csv"))

# Same
map_chr(dfms, ~ format_path(names(.), "csv", ".", "this-"))
```

This is how to use it in a pipeline:

```{r}
list_csv() %>% 
  walk2(
    imap_chr(dfms, ~ format_path(.y, "csv", base = ".", prefix = "this-")), 
    write.csv
  )

dir_ls(".", regexp = "this-")
```

```{r include=FALSE}
fs::file_delete(fs::dir_ls(".", regexp = "this-"))
```

# Related projects

There are great packages to read and write data, for example [__rio__](https://CRAN.R-project.org/package=rio) and [__io__](https://CRAN.R-project.org/package=io). __tor__ does less than the alternatives, but it is much smaller and more flexible.

