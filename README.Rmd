---
output: github_document
editor_options: 
  chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# tor

[![lifecycle](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![Travis build status](https://travis-ci.org/maurolepore/tor.svg?branch=master)](https://travis-ci.org/maurolepore/tor)
[![Coverage status](https://coveralls.io/repos/github/maurolepore/tor/badge.svg)](https://coveralls.io/r/maurolepore/tor?branch=master)
[![CRAN status](https://www.r-pkg.org/badges/version/tor)](https://cran.r-project.org/package=tor)

The goal of __tor__ (_to-R_) is to help you to read multiple files from a single directory into R, and to do so as quickly, flexibly, and simply as possible. It does nothing you can't do with functions from base R but it makes a frequent task less painful. It has few dependencies and works well with the [tidyverse](https://www.tidyverse.org/). 

## Installation

``` r
# install.packages("devtools")
devtools::install_github("maurolepore/tor")
```

## Example

```{r}
library(tidyverse)
library(fs)
library(tor)
```

All functions list whatever they read, and default to reading from the working directory.

```{r}
dir()

list_csv()
```

Often you will specify a `path` to read from.

```{r}
# Helpes create paths to examples
tor_example()

(path_rds <- tor_example("rds"))
dir(path_rds)

list_rds(path_rds)
```

You may read all files with a particular extension.

```{r}
path_mixed <- tor_example("mixed")
dir(path_mixed)

list_rdata(path_mixed)
```

Or you may read specific files matching a pattern.

```{r}
list_rdata(path_mixed, regexp = "[.]RData", ignore.case = FALSE)
```

`list_any()` is the most flexible function. You supply the function to read with.

```{r}
(path_csv <- tor_example("csv"))
dir(path_csv)

list_any(path_csv, read.csv)
```

It understands lambda functions and formulas (powered by [__rlang__](https://rlang.r-lib.org/)).

```{r}
(path_rdata <- tor_example("rdata"))
dir(path_rdata)

path_rdata %>% 
  list_any(function(x) get(load(x)))

# Same
path_rdata %>% 
  list_any(~get(load(.x)))
```

Pass additional arguments via `...` or inside the lambda function.

```{r}
path_csv %>% 
  list_any(readr::read_csv, skip = 1)

path_csv %>% 
  list_any(~read.csv(., stringsAsFactors = FALSE)) %>% 
  map(as_tibble)
```

It also provides the arguments `regexp`, `ignore.case`, and `invert` to pick specific files in a directory (powered by [__fs__](https://fs.r-lib.org/)).

```{r}
path_mixed <- tor_example("mixed")
dir(path_mixed)

path_mixed %>% 
  list_any(~get(load(.)), "[.]Rdata$", ignore.case = TRUE)

path_mixed %>% 
  list_any(~get(load(.)), regexp = "[.]csv$", invert = TRUE)
```

### From the list

#### Map each list element to an object in an environment

Add each element to an environment with `list2env()`

```{r}
rm(list = ls())
ls()

list2env(list_csv(), envir = .GlobalEnv)

ls()
```

#### Map each list element to a file in a directory

__tor__ does not write data but includes a helper to create the paths to output files.

```{r}
dir(pattern = "[.]csv$")

dfms <- list_csv()

format_path(names(dfms), "csv")

format_path(names(dfms), "csv", base = "home", prefix = "this-")
```

Combine it with [__purrr__](https://purrr.tidyverse.org/).

```{r}
imap_chr(dfms, ~ format_path(.y, "csv"))

# Same
map_chr(dfms, ~ format_path(names(.), "csv", ".", "this-"))

(dfs <- list_csv())

paths <- dfs %>% 
  imap_chr(~ format_path(.y, "csv", base = ".", prefix = "this-"))

walk2(dfs, paths, readr::write_csv)

dir_ls(".", regexp = "this-")
```

```{r include=FALSE}
fs::file_delete(fs::dir_ls(".", regexp = "this-"))
```

# Related projects

There are great packages to read and write data, for example [__rio__](https://CRAN.R-project.org/package=rio) and [__io__](https://CRAN.R-project.org/package=io). __tor__ does less than the alternatives, but it is much smaller and more flexible.

